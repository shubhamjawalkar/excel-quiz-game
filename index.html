<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Excel & VBA Master Assessment</title>

<style>
*{box-sizing:border-box}
body{
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background:linear-gradient(135deg,#1f4037,#99f2c8);
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
}
.container{
    background:white;
    width:1000px;
    max-width:95%;
    padding:30px;
    border-radius:18px;
    box-shadow:0 20px 50px rgba(0,0,0,0.25);
}
.card{
    background:#f7f9f8;
    padding:15px;
    border-radius:12px;
}
input{
    width:100%;
    padding:10px;
    margin:6px 0;
    border-radius:8px;
    border:1px solid #ccc;
}
button{
    padding:10px 18px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    background:#1f4037;
    color:white;
    margin-top:8px;
}
button:hover{opacity:0.9}
.option{
    padding:10px;
    margin:6px 0;
    border-radius:8px;
    border:1px solid #ddd;
    cursor:pointer;
}
.option:hover{background:#f1f1f1}
.selected{
    background:#1f4037;
    color:white;
}
.progress{
    height:8px;
    background:#eee;
    border-radius:10px;
    margin-bottom:10px;
}
.progress-bar{
    height:8px;
    background:#1f4037;
    width:0%;
    border-radius:10px;
}
.timer{color:#d32f2f;font-weight:bold;}
.leaderboard{max-height:160px;overflow:auto;margin-bottom:15px;}
.hidden{display:none}
</style>
</head>

<body>
<div class="container">

<div id="startScreen">

<h2 style="text-align:center;">Excel & VBA Master Assessment</h2>

<div style="display:flex;gap:20px;flex-wrap:wrap;justify-content:center;margin-top:20px;">

    <!-- Leaderboard Card -->
    <div class="card" style="flex:1;min-width:300px;max-width:420px;">
        <h3>üèÜ Leaderboard</h3>
        <div id="leaderboardList" class="leaderboard">Loading...</div>
    </div>

    <!-- Login Card -->
    <div class="card" style="flex:1;min-width:300px;max-width:420px;">
        <h3>üéØ Start Test</h3>

        <input type="text" id="name" placeholder="Enter Name">
        <input type="email" id="email" placeholder="Enter Email">
        <button onclick="startTest()">Start Test</button>
    </div>

</div>
</div>
<div id="quizScreen" class="hidden">
<div class="timer">‚è≥ Time Left: <span id="time">30:00</span></div>
<div class="progress"><div class="progress-bar" id="progressBar"></div></div>
<h3 id="question"></h3>
<div id="options"></div>
<button onclick="nextQuestion()">Next</button>
</div>

<div id="dashboard" class="hidden">

<h2 style="text-align:center;">Assessment Report</h2>

<div style="display:flex;gap:20px;flex-wrap:wrap;justify-content:center;margin-top:20px;">

    <!-- Score Card -->
    <div class="card" style="flex:1;min-width:300px;max-width:420px;text-align:center;">
        <h3>üìä Score Summary</h3>
        <h1 id="finalScore"></h1>
        <h2 id="performance"></h2>
    </div>

    <!-- Details Card -->
    <div class="card" style="flex:1;min-width:300px;max-width:420px;">
        <h3>üë§ Candidate Details</h3>
        <p id="userInfo"></p>
        <p id="timeTaken"></p>
    </div>

</div>

<div style="text-align:center;margin-top:25px;">
    <button onclick="location.reload()">Restart</button>
</div>

</div>
<script>

const API_URL="https://script.google.com/macros/s/AKfycbx7o7E9f3VPwo-M3T2SkOz05UENmi3WANiAVXunhhBlgTlg2eZ2rKcL3QCyd8M_xmOb/exec";

let userName="",userEmail="";
let current=0,score=0;
let selectedAnswer=null;
let timerInterval;
let timeRemaining=1800;

/* ================= 50 QUESTIONS ================= */

const questions=[

/* Core (10) */
{q:"Which function returns row number?",o:["ROW","COLUMN","INDEX","CELL"],a:0},
{q:"Which function counts non-empty cells?",o:["COUNT","COUNTA","COUNTIF","SUM"],a:1},
{q:"Which function extracts left text?",o:["LEFT","RIGHT","MID","TEXT"],a:0},
{q:"Which function returns column number?",o:["COLUMN","COL","INDEX","CELL"],a:0},
{q:"Which function returns current date?",o:["NOW","DATE","TODAY","TIME"],a:2},
{q:"Which function rounds number?",o:["ROUND","INT","TRUNC","FIX"],a:0},
{q:"Which function checks if number?",o:["ISNUMBER","ISNUM","CHECK","TYPE"],a:0},
{q:"Which function finds position?",o:["MATCH","INDEX","LOOKUP","SEARCH"],a:0},
{q:"Which function handles errors?",o:["IFERROR","ERROR","TRY","CATCH"],a:0},
{q:"Which function trims spaces?",o:["CLEAN","TRIM","REMOVE","STRIP"],a:1},

/* Lookup & Arrays (10) */
{q:"Which function returns unique values?",o:["UNIQUE","FILTER","MATCH","INDEX"],a:0},
{q:"Which function filters by criteria?",o:["FILTER","SORT","MATCH","LOOKUP"],a:0},
{q:"Which function sorts array?",o:["ORDER","SORT","RANK","ARRANGE"],a:1},
{q:"Which replaces VLOOKUP?",o:["INDEX","MATCH","XLOOKUP","LOOKUP"],a:2},
{q:"Which finds nth largest?",o:["MAX","TOP","LARGE","HIGH"],a:2},
{q:"Which joins with delimiter?",o:["JOIN","TEXTJOIN","CONCAT","MERGE"],a:1},
{q:"Which spills dynamic array?",o:["UNIQUE","OFFSET","INDIRECT","CELL"],a:0},
{q:"Which returns multiple matches?",o:["MATCH","FILTER","LOOKUP","INDEX"],a:1},
{q:"Which converts text to number?",o:["VALUE","NUM","TEXT","CONVERT"],a:0},
{q:"Which function returns month?",o:["MONTH","DATE","YEAR","NOW"],a:0},

/* Advanced Excel (10) */
{q:"Which summarizes data?",o:["Charts","Pivot Table","Filter","Validation"],a:1},
{q:"Which builds relationships?",o:["Power Query","Power Pivot","Solver","Pivot"],a:1},
{q:"Which removes duplicates?",o:["Filter","Remove Duplicates","Sort","Clean"],a:1},
{q:"Which forecasts trends?",o:["Solver","Forecast Sheet","Pivot","Macro"],a:1},
{q:"Which calculates NPV?",o:["NPV","IRR","PMT","FV"],a:0},
{q:"Which calculates IRR?",o:["NPV","IRR","RATE","FV"],a:1},
{q:"Which function is volatile?",o:["SUM","OFFSET","INDEX","MATCH"],a:1},
{q:"Which handles multiple conditions?",o:["IF","IFS","SWITCH","All"],a:3},
{q:"Which returns weekday?",o:["DAY","WEEKDAY","DATE","NOW"],a:1},
{q:"Which introduced dynamic arrays?",o:["2010","2013","2016","365"],a:3},

/* VBA (20) */
{q:"What does VBA stand for?",o:["Visual Basic Application","Visual Basic for Applications","Virtual Basic","Visual Batch Automation"],a:1},
{q:"Shortcut to open VBA editor?",o:["Alt+F8","Alt+F11","Ctrl+F11","Shift+F11"],a:1},
{q:"Which declares variable?",o:["Dim","Set","Var","Let"],a:0},
{q:"Which handles errors?",o:["On Error","Try","Catch","Handle"],a:0},
{q:"Which loop repeats until false?",o:["For","While","Do Until","Loop"],a:2},
{q:"Which object represents workbook?",o:["Sheet","Workbook","Range","Cell"],a:1},
{q:"Which method saves workbook?",o:["Save()","Workbook.Save","ActiveWorkbook.Save","File.Save"],a:2},
{q:"Which assigns object?",o:["Dim","Set","Let","Var"],a:1},
{q:"Which runs on workbook open?",o:["Workbook_Start","Workbook_Open","AutoRun","OpenEvent"],a:1},
{q:"Which closes workbook?",o:["Close()","Workbook.Close","ActiveWorkbook.Close","File.Close"],a:2},
{q:"Which loop repeats fixed times?",o:["For","While","Do","Until"],a:0},
{q:"Which object refers to range?",o:["Cells","Range","Sheet","Book"],a:1},
{q:"Which statement exits loop?",o:["Break","Exit For","Stop","Return"],a:1},
{q:"Which keyword assigns value?",o:["Set","Let","Dim","Const"],a:1},
{q:"Which keyword defines constant?",o:["Dim","Set","Const","Static"],a:2},
{q:"Which event runs before close?",o:["Workbook_Close","Workbook_End","CloseEvent","Stop"],a:0},
{q:"Which creates message box?",o:["MsgBox","Alert","Message","Show"],a:0},
{q:"Which gets active sheet?",o:["ActiveSheet","CurrentSheet","SheetActive","ThisSheet"],a:0},
{q:"Which declares public variable?",o:["Public","Dim","Set","Global"],a:0},
{q:"Which references this workbook?",o:["ActiveWorkbook","ThisWorkbook","Workbook","CurrentWorkbook"],a:1}

];

/* ================= TIMER ================= */

function startTimer(){
timerInterval=setInterval(()=>{
timeRemaining--;
let m=Math.floor(timeRemaining/60);
let s=timeRemaining%60;
document.getElementById("time").innerText=`${m}:${s<10?"0"+s:s}`;
if(timeRemaining<=0){clearInterval(timerInterval);showDashboard();}
},1000);
}

/* ================= QUIZ ================= */

function startTest(){
userName=document.getElementById("name").value;
userEmail=document.getElementById("email").value;
if(!userName||!userEmail){alert("Enter Name & Email");return;}

document.getElementById("startScreen").classList.add("hidden");
document.getElementById("quizScreen").classList.remove("hidden");

startTimer();
loadQuestion();
}

function loadQuestion(){
selectedAnswer=null;
let q=questions[current];
document.getElementById("question").innerText=(current+1)+". "+q.q;

let html="";
q.o.forEach((opt,i)=>{
html+=`<div class="option" onclick="selectOption(this,${i})">${opt}</div>`;
});
document.getElementById("options").innerHTML=html;
document.getElementById("progressBar").style.width=((current)/questions.length)*100+"%";
}

function selectOption(el,i){
document.querySelectorAll(".option").forEach(o=>o.classList.remove("selected"));
el.classList.add("selected");
selectedAnswer=i;
}

function nextQuestion(){
if(selectedAnswer===null){alert("Select option");return;}
if(selectedAnswer===questions[current].a){score++;}
current++;
if(current<questions.length){loadQuestion();}
else{showDashboard();}
}

/* ================= SAVE ================= */

async function saveResult(){
await fetch(API_URL,{
method:"POST",
mode:"no-cors",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
name:userName,
email:userEmail,
score:score,
percentage:Math.round((score/questions.length)*100),
timeTaken:1800-timeRemaining
})
});
}

/* ================= DASHBOARD ================= */

async function showDashboard(){
clearInterval(timerInterval);
document.getElementById("quizScreen").classList.add("hidden");
document.getElementById("dashboard").classList.remove("hidden");

let percentage=Math.round((score/questions.length)*100);

document.getElementById("userInfo").innerText=userName+" | "+userEmail;
document.getElementById("finalScore").innerText="Score: "+score+" / "+questions.length+" ("+percentage+"%)";
document.getElementById("performance").innerText=percentage>=60?"PASS":"FAIL";

await saveResult();
}

/* ================= FAST LEADERBOARD ================= */

async function loadLeaderboard(){
try{
const res=await fetch(API_URL);
const data=await res.json();
let html="";
data.forEach((row,index)=>{
html+=`<div>${index+1}. <strong>${row.name}</strong> - ${row.score}</div>`;
});
document.getElementById("leaderboardList").innerHTML=html||"No attempts yet.";
}catch{
document.getElementById("leaderboardList").innerHTML="Unable to load leaderboard.";
}
}

window.addEventListener("DOMContentLoaded",()=>{
setTimeout(loadLeaderboard,200);
});

</script>
</body>
</html>
