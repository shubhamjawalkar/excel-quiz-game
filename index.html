<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Excel & VBA Master Assessment</title>

<style>
*{box-sizing:border-box}
body{
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background:linear-gradient(135deg,#1f4037,#99f2c8);
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
}
.container{
    background:white;
    width:1000px;
    max-width:95%;
    padding:30px;
    border-radius:18px;
    box-shadow:0 20px 50px rgba(0,0,0,0.25);
}
input{
    width:100%;
    padding:10px;
    margin:6px 0;
    border-radius:8px;
    border:1px solid #ccc;
}
button{
    padding:10px 18px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    background:#1f4037;
    color:white;
    margin-top:8px;
}
button:hover{opacity:0.9}
.option{
    padding:10px;
    margin:6px 0;
    border-radius:8px;
    border:1px solid #ddd;
    cursor:pointer;
}
.option:hover{background:#f1f1f1}
.selected{
    background:#1f4037;
    color:white;
}
.progress{
    height:8px;
    background:#eee;
    border-radius:10px;
    margin-bottom:10px;
}
.progress-bar{
    height:8px;
    background:#1f4037;
    width:0%;
    border-radius:10px;
}
.timer{color:#d32f2f;font-weight:bold;}
.leaderboard{max-height:150px;overflow:auto;}
.hidden{display:none}
</style>
</head>

<body>
<div class="container">

<div id="startScreen">
<h2>Excel & VBA Master Assessment</h2>
<h3>üèÜ Leaderboard</h3>
<div id="leaderboardList" class="leaderboard">Loading...</div>
<input type="text" id="name" placeholder="Enter Name">
<input type="email" id="email" placeholder="Enter Email">
<button onclick="startTest()">Start Test</button>
</div>

<div id="quizScreen" class="hidden">
<div class="timer">‚è≥ Time Left: <span id="time">30:00</span></div>
<div class="progress"><div class="progress-bar" id="progressBar"></div></div>
<h3 id="question"></h3>
<div id="options"></div>
<button onclick="nextQuestion()">Next</button>
</div>

<div id="dashboard" class="hidden">
<h2>Assessment Report</h2>
<p id="userInfo"></p>
<p id="finalScore"></p>
<p id="performance"></p>
</div>

</div>

<script>

const API_URL="YOUR_DEPLOYED_WEB_APP_URL_HERE";

let userName="",userEmail="";
let current=0,score=0;
let selectedAnswer=null;
let timerInterval;
let timeRemaining=1800;

/* ================= 50 ADVANCED QUESTIONS ================= */

const questions=[

/* LEVEL 1 ‚Äì Core Functions */
{q:"Which function returns row number of a cell?",o:["ROW","COLUMN","INDEX","CELL"],a:0},
{q:"Which function counts non-empty cells?",o:["COUNT","COUNTA","COUNTIF","SUM"],a:1},
{q:"Which function extracts left text?",o:["LEFT","RIGHT","MID","TEXT"],a:0},
{q:"Which function returns current date only?",o:["NOW","DATE","TODAY","TIME"],a:2},
{q:"Which function returns column number?",o:["COLUMN","COL","INDEX","CELL"],a:0},
{q:"Which function rounds to nearest integer?",o:["ROUND","INT","TRUNC","FIX"],a:0},
{q:"Which function checks if value is number?",o:["ISNUMBER","ISNUM","CHECK","TYPE"],a:0},
{q:"Which function returns position of value?",o:["MATCH","INDEX","LOOKUP","SEARCH"],a:0},
{q:"Which function concatenates text?",o:["MERGE","JOIN","CONCAT","TEXTJOIN"],a:3},
{q:"Which function handles errors?",o:["IFERROR","ERROR","TRY","CATCH"],a:0},

/* LEVEL 2 ‚Äì Lookup & Arrays */
{q:"Which function returns unique values?",o:["UNIQUE","FILTER","MATCH","INDEX"],a:0},
{q:"Which function filters data by criteria?",o:["FILTER","SORT","LOOKUP","MATCH"],a:0},
{q:"Which function sorts array?",o:["ORDER","RANK","SORT","ARRANGE"],a:2},
{q:"Which function looks up vertically?",o:["HLOOKUP","VLOOKUP","LOOKUP","XLOOKUP"],a:1},
{q:"Which function replaces VLOOKUP in 365?",o:["INDEX","MATCH","XLOOKUP","LOOKUP"],a:2},
{q:"Which function returns nth largest value?",o:["MAX","TOP","LARGE","HIGH"],a:2},
{q:"Which function joins range with delimiter?",o:["JOIN","TEXTJOIN","CONCAT","MERGE"],a:1},
{q:"Which function spills dynamic array?",o:["UNIQUE","OFFSET","INDIRECT","CELL"],a:0},
{q:"Which function returns multiple matches?",o:["MATCH","FILTER","LOOKUP","INDEX"],a:1},
{q:"Which function converts text to number?",o:["VALUE","NUM","TEXT","CONVERT"],a:0},

/* LEVEL 3 ‚Äì Advanced Excel */
{q:"Which feature summarizes large datasets?",o:["Pivot Table","Charts","Filter","Validation"],a:0},
{q:"Which feature builds relationships between tables?",o:["Power Query","Power Pivot","Pivot Table","Solver"],a:1},
{q:"Which tool removes duplicates?",o:["Filter","Sort","Remove Duplicates","Clean"],a:2},
{q:"Which function returns weekday?",o:["DAY","WEEKDAY","DATE","NOW"],a:1},
{q:"Which function handles multiple IF conditions?",o:["IF","IFS","SWITCH","All"],a:3},
{q:"Which function is volatile?",o:["SUM","OFFSET","INDEX","MATCH"],a:1},
{q:"Which tool forecasts trends?",o:["Solver","Forecast Sheet","Pivot","Macro"],a:1},
{q:"Which function calculates NPV?",o:["NPV","IRR","PMT","FV"],a:0},
{q:"Which function calculates IRR?",o:["NPV","IRR","RATE","FV"],a:1},
{q:"Which function trims extra spaces?",o:["CLEAN","TRIM","REMOVE","STRIP"],a:1},

/* LEVEL 4 ‚Äì Data & Modeling */
{q:"Which Excel version introduced dynamic arrays?",o:["2010","2013","2016","365"],a:3},
{q:"Which function returns substring position?",o:["FIND","SEARCH","MATCH","INDEX"],a:1},
{q:"Which function calculates CAGR directly?",o:["RATE","IRR","XIRR","None"],a:3},
{q:"Which function calculates loan payment?",o:["NPV","PMT","FV","IRR"],a:1},
{q:"Which object refers to cell range in VBA?",o:["Cells","Range","Sheet","Book"],a:1},
{q:"Which feature protects worksheet?",o:["Lock","Protect Sheet","Hide","Freeze"],a:1},
{q:"Which function extracts right text?",o:["LEFT","RIGHT","MID","TEXT"],a:1},
{q:"Which function returns month number?",o:["MONTH","DATE","YEAR","NOW"],a:0},
{q:"Which function calculates average?",o:["AVG","AVERAGE","MEAN","MID"],a:1},
{q:"Which tool records automation steps?",o:["Macro Recorder","Solver","Pivot","Forecast"],a:0},

/* LEVEL 5 ‚Äì VBA (Advanced) */
{q:"What does VBA stand for?",o:["Visual Basic Application","Visual Basic for Applications","Virtual Basic","Visual Batch Automation"],a:1},
{q:"Shortcut to open VBA editor?",o:["Alt+F8","Alt+F11","Ctrl+F11","Shift+F11"],a:1},
{q:"Which keyword declares variable?",o:["Dim","Set","Var","Let"],a:0},
{q:"Which statement handles errors?",o:["On Error","Try","Catch","Handle"],a:0},
{q:"Which loop repeats until condition false?",o:["For","While","Do Until","Loop"],a:2},
{q:"Which object represents workbook?",o:["Sheet","Workbook","Range","Cell"],a:1},
{q:"Which method saves workbook?",o:["Save()","Workbook.Save","ActiveWorkbook.Save","File.Save"],a:2},
{q:"Which VBA keyword assigns object?",o:["Dim","Set","Let","Var"],a:1},
{q:"Which event runs when workbook opens?",o:["Workbook_Start","Workbook_Open","AutoRun","OpenEvent"],a:1},
{q:"Which VBA method closes workbook?",o:["Close()","Workbook.Close","ActiveWorkbook.Close","File.Close"],a:2}

];

/* ================= TIMER ================= */

function startTimer(){
timerInterval=setInterval(()=>{
timeRemaining--;
let m=Math.floor(timeRemaining/60);
let s=timeRemaining%60;
document.getElementById("time").innerText=`${m}:${s<10?"0"+s:s}`;
if(timeRemaining<=0){clearInterval(timerInterval);showDashboard();}
},1000);
}

/* ================= QUIZ LOGIC ================= */

function startTest(){
userName=document.getElementById("name").value;
userEmail=document.getElementById("email").value;
if(!userName||!userEmail){alert("Enter Name & Email");return;}

document.getElementById("startScreen").classList.add("hidden");
document.getElementById("quizScreen").classList.remove("hidden");

startTimer();
loadQuestion();
}

function loadQuestion(){
selectedAnswer=null;
let q=questions[current];
document.getElementById("question").innerText=(current+1)+". "+q.q;

let html="";
q.o.forEach((opt,i)=>{
html+=`<div class="option" onclick="selectOption(this,${i})">${opt}</div>`;
});
document.getElementById("options").innerHTML=html;
document.getElementById("progressBar").style.width=((current)/questions.length)*100+"%";
}

function selectOption(el,i){
document.querySelectorAll(".option").forEach(o=>o.classList.remove("selected"));
el.classList.add("selected");
selectedAnswer=i;
}

function nextQuestion(){
if(selectedAnswer===null){alert("Select option");return;}
if(selectedAnswer===questions[current].a){score++;}
current++;
if(current<questions.length){loadQuestion();}
else{showDashboard();}
}

/* ================= SAVE RESULT ================= */

async function saveResult(){
await fetch(API_URL,{
method:"POST",
mode:"no-cors",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
name:userName,
email:userEmail,
score:score,
percentage:Math.round((score/questions.length)*100),
timeTaken:1800-timeRemaining
})
});
}

/* ================= DASHBOARD ================= */

async function showDashboard(){
clearInterval(timerInterval);
document.getElementById("quizScreen").classList.add("hidden");
document.getElementById("dashboard").classList.remove("hidden");

let percentage=Math.round((score/questions.length)*100);

document.getElementById("userInfo").innerText=userName+" | "+userEmail;
document.getElementById("finalScore").innerText="Score: "+score+" / "+questions.length+" ("+percentage+"%)";
document.getElementById("performance").innerText=percentage>=60?"PASS":"FAIL";

await saveResult();
}

/* ================= FAST LEADERBOARD ================= */

async function loadLeaderboard(){
try{
const res=await fetch(API_URL);
const data=await res.json();

let html="";
data.forEach((row,index)=>{
html+=`<div>${index+1}. <strong>${row.name}</strong> - ${row.score}</div>`;
});

document.getElementById("leaderboardList").innerHTML=html||"No attempts yet.";
}catch{
document.getElementById("leaderboardList").innerHTML="Unable to load leaderboard.";
}
}

window.addEventListener("DOMContentLoaded",()=>{
setTimeout(loadLeaderboard,200);
});

</script>
</body>
</html>
