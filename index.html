<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Excel & VBA Master Assessment</title>

<style>
body{
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background:linear-gradient(135deg,#1f4037,#99f2c8);
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}
.container{
    background:white;
    width:750px;
    max-width:95%;
    padding:30px;
    border-radius:12px;
    box-shadow:0 15px 40px rgba(0,0,0,0.2);
}
input{
    width:100%;
    padding:12px;
    margin:10px 0;
    border-radius:6px;
    border:1px solid #ccc;
}
button{
    padding:12px 20px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    background:#1f4037;
    color:white;
    margin-top:10px;
}
.option{
    display:block;
    padding:10px;
    margin:8px 0;
    border-radius:6px;
    border:1px solid #ddd;
    cursor:pointer;
}
.option:hover{background:#f2f2f2}
.selected{
    background:#1f4037;
    color:white;
}
.progress{
    height:8px;
    background:#eee;
    border-radius:5px;
    margin-bottom:15px;
}
.progress-bar{
    height:8px;
    background:#1f4037;
    width:0%;
    border-radius:5px;
}
.timer{
    font-weight:bold;
    color:#d32f2f;
    margin-bottom:10px;
}
.leaderboard{
    max-height:150px;
    overflow:auto;
    margin-top:15px;
    border-top:1px solid #ddd;
    padding-top:10px;
    font-size:14px;
}
.hidden{display:none}
</style>
</head>

<body>
<div class="container">

<div id="startScreen">
    <h2>Excel & VBA Master Assessment</h2>
    <h3>üèÜ Global Leaderboard</h3>
    <div id="leaderboardList" class="leaderboard">Loading...</div>
    <input type="text" id="name" placeholder="Enter Your Name">
    <input type="email" id="email" placeholder="Enter Your Email">
    <button onclick="startTest()">Start Test</button>
</div>

<div id="quizScreen" class="hidden">
    <div class="timer">‚è≥ Time Left: <span id="time">30:00</span></div>
    <div class="progress">
        <div class="progress-bar" id="progressBar"></div>
    </div>
    <h3 id="question"></h3>
    <div id="options"></div>
    <button onclick="nextQuestion()">Next</button>
</div>

<div id="dashboard" class="hidden">
    <h2>üéâ Assessment Completed</h2>

    <div style="display:flex; justify-content:space-between; margin-top:20px; gap:20px; flex-wrap:wrap;">

        <!-- Score Card -->
        <div style="flex:1; min-width:250px; background:#f4f7f6; padding:20px; border-radius:10px;">
            <h3>üìä Score Overview</h3>
            <div id="circleContainer" style="position:relative; width:150px; height:150px; margin:auto;">
                <svg width="150" height="150">
                    <circle cx="75" cy="75" r="65" stroke="#eee" stroke-width="12" fill="none"/>
                    <circle id="progressCircle" cx="75" cy="75" r="65"
                        stroke="#1f4037"
                        stroke-width="12"
                        fill="none"
                        stroke-dasharray="408"
                        stroke-dashoffset="408"
                        stroke-linecap="round"
                        transform="rotate(-90 75 75)"/>
                </svg>
                <div id="percentageText"
                     style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
                     font-size:22px; font-weight:bold;">
                </div>
            </div>
        </div>

        <!-- Details Card -->
        <div style="flex:1; min-width:250px; background:#f4f7f6; padding:20px; border-radius:10px;">
            <h3>üë§ Candidate Details</h3>
            <p id="userInfo"></p>
            <p id="finalScore"></p>
            <p id="timeTaken"></p>
            <p id="performance" style="font-weight:bold;"></p>
            <p id="passFail" style="font-size:18px;"></p>
        </div>
    </div>

    <div style="margin-top:25px;">
        <button onclick="location.reload()">üîÅ Restart Test</button>
    </div>
</div>
<script>

const API_URL="https://script.google.com/macros/s/AKfycbw_XB3KTyGXz-etw84Ttrvg1BWmzxH16fAM4MWOAMpY9qH4UqIqkDY9dQNpTUZdZNiu/exec";

let userName="",userEmail="";
let current=0,score=0,selectedAnswer=null;
let timerInterval;
let timeRemaining=1800;

const questions=[
{q:"Which function returns dynamic array in Excel 365?",o:["VLOOKUP","FILTER","INDEX","OFFSET"],a:1},
{q:"What does VBA stand for?",o:["Visual Basic Application","Visual Basic for Applications","Virtual Basic","Visual Batch Automation"],a:1},
{q:"Which function extracts middle text?",o:["LEFT","MID","RIGHT","TEXT"],a:1},
{q:"Shortcut to open VBA Editor?",o:["Alt+F8","Alt+F11","Ctrl+F11","Shift+F11"],a:1},
{q:"Which function returns unique values?",o:["UNIQUE","FILTER","DISTINCT","MATCH"],a:0},
{q:"Which function handles errors?",o:["IFERROR","ERROR","TRY","ISERROR"],a:0},
{q:"Which is a volatile function?",o:["SUM","INDEX","OFFSET","MATCH"],a:2},
{q:"Which function joins text with delimiter?",o:["JOIN","CONCAT","TEXTJOIN","MERGE"],a:2},
{q:"Which Excel tool removes duplicates?",o:["Filter","Sort","Remove Duplicates","Clean"],a:2},
{q:"Which function counts non-empty cells?",o:["COUNT","COUNTA","COUNTIF","SUM"],a:1},

{q:"Which function returns row number?",o:["ROW","ROWS","INDEX","CELL"],a:0},
{q:"Which function returns column number?",o:["COLUMN","COL","INDEX","CELL"],a:0},
{q:"Which function returns current date?",o:["NOW","DATE","TODAY","CURRENT"],a:2},
{q:"Which function returns substring position?",o:["FIND","SEARCH","MATCH","INDEX"],a:1},
{q:"Which object represents workbook in VBA?",o:["Sheet","Workbook","Range","Cell"],a:1},
{q:"Which keyword declares variable in VBA?",o:["Dim","Set","Var","Let"],a:0},
{q:"Which statement handles errors in VBA?",o:["On Error","Error Handle","Try","Catch"],a:0},
{q:"Which function returns maximum?",o:["MAX","LARGE","TOP","HIGH"],a:0},
{q:"Which function returns minimum?",o:["MIN","SMALL","LOW","BOTTOM"],a:0},
{q:"Which function converts text to number?",o:["VALUE","TEXT","CONVERT","NUM"],a:0},

{q:"Which Excel feature summarizes data?",o:["Charts","Pivot Table","Formatting","Validation"],a:1},
{q:"Which function rounds number?",o:["ROUND","FIX","INT","TRUNC"],a:0},
{q:"Which function returns month?",o:["MONTH","DATE","YEAR","NOW"],a:0},
{q:"Which function checks if number?",o:["ISNUMBER","ISNUM","CHECK","VALID"],a:0},
{q:"Which function extracts left text?",o:["LEFT","MID","RIGHT","TEXT"],a:0},
{q:"Which function replaces text?",o:["REPLACE","SUBSTITUTE","CHANGE","SWAP"],a:1},
{q:"Which function trims spaces?",o:["TRIM","CLEAN","REMOVE","STRIP"],a:0},
{q:"Which function handles arrays?",o:["INDEX","OFFSET","FILTER","SUM"],a:2},
{q:"Which loop repeats until condition false?",o:["For","While","Do Until","Loop"],a:2},
{q:"Which Excel version introduced dynamic arrays?",o:["2010","2013","2016","365"],a:3},

{q:"Which function returns weekday?",o:["DAY","WEEKDAY","DATE","TODAY"],a:1},
{q:"Which feature protects worksheet?",o:["Lock","Protect Sheet","Freeze","Hide"],a:1},
{q:"Which function returns NPV?",o:["NPV","IRR","PMT","FV"],a:0},
{q:"Which function calculates average?",o:["AVG","AVERAGE","MEAN","MID"],a:1},
{q:"Which function looks up vertically?",o:["HLOOKUP","VLOOKUP","INDEX","MATCH"],a:1},
{q:"Which function returns TRUE logical?",o:["ISLOGICAL","TRUE","IF","BOOL"],a:1},
{q:"Which function converts case?",o:["UPPER","LOWER","PROPER","All"],a:3},
{q:"Which method saves workbook in VBA?",o:["Save()","Workbook.Save","ActiveWorkbook.Save","File.Save"],a:2},
{q:"Which function returns position in array?",o:["MATCH","INDEX","SEARCH","LOOKUP"],a:0},
{q:"Which function joins multiple ranges?",o:["CONCAT","TEXTJOIN","JOIN","MERGE"],a:1},

{q:"Which function returns logical check?",o:["IF","SWITCH","IFS","All"],a:3},
{q:"Which feature builds data models?",o:["Power Pivot","Charts","Validation","Filter"],a:0},
{q:"Which tool forecasts trends?",o:["Pivot","Solver","Forecast Sheet","Macro"],a:2},
{q:"Which macro tool records actions?",o:["Macro Recorder","Solver","Goal Seek","Pivot"],a:0},
{q:"Which function handles multiple conditions?",o:["IF","IFS","SWITCH","All"],a:3},
{q:"Which VBA method closes workbook?",o:["Close()","Workbook.Close","ActiveWorkbook.Close","File.Close"],a:2},
{q:"Which function calculates IRR?",o:["NPV","IRR","PMT","FV"],a:1},
{q:"Which function extracts right text?",o:["LEFT","MID","RIGHT","TEXT"],a:2},
{q:"Which Excel object refers to range?",o:["Cells","Range","Sheet","Book"],a:1},
{q:"Which function finds largest nth value?",o:["LARGE","MAX","TOP","HIGH"],a:0}
];

async function loadLeaderboard(){
    try{
        const res=await fetch(API_URL);
        const data=await res.json();
        const filtered=data.filter(r=>r[1]&&r[3]);
        filtered.sort((a,b)=>b[3]-a[3]);
        let html="";
        filtered.slice(0,10).forEach((row,i)=>{
            html+=`${i+1}. ${row[1]} - ${row[3]}/50<br>`;
        });
        document.getElementById("leaderboardList").innerHTML=html||"No attempts yet.";
    }catch{
        document.getElementById("leaderboardList").innerHTML="Error loading leaderboard.";
    }
}

async function saveResult(){
    await fetch(API_URL,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
            name:userName,
            email:userEmail,
            score:score,
            percentage:Math.round((score/50)*100),
            timeTaken:1800-timeRemaining
        })
    });
}

function startTest(){
    userName=document.getElementById("name").value;
    userEmail=document.getElementById("email").value;
    if(!userName||!userEmail){alert("Please enter Name and Email");return;}
    document.getElementById("startScreen").classList.add("hidden");
    document.getElementById("quizScreen").classList.remove("hidden");
    startTimer();
    loadQuestion();
}

function startTimer(){
    timerInterval=setInterval(()=>{
        timeRemaining--;
        let m=Math.floor(timeRemaining/60);
        let s=timeRemaining%60;
        document.getElementById("time").innerText=`${m}:${s<10?"0"+s:s}`;
        if(timeRemaining<=0){clearInterval(timerInterval);showDashboard();}
    },1000);
}

function loadQuestion(){
    selectedAnswer=null;
    let q=questions[current];
    document.getElementById("question").innerText=(current+1)+". "+q.q;
    let html="";
    q.o.forEach((opt,i)=>{
        html+=`<div class="option" onclick="selectOption(this,${i})">${opt}</div>`;
    });
    document.getElementById("options").innerHTML=html;
    document.getElementById("progressBar").style.width=((current)/50)*100+"%";
}

function selectOption(el,i){
    document.querySelectorAll(".option").forEach(o=>o.classList.remove("selected"));
    el.classList.add("selected");
    selectedAnswer=i;
}

function nextQuestion(){
    if(selectedAnswer===null){alert("Please select an option.");return;}
    if(selectedAnswer===questions[current].a){score++;}
    current++;
    if(current<questions.length){loadQuestion();}else{showDashboard();}
}

async function showDashboard(){
    clearInterval(timerInterval);

    document.getElementById("quizScreen").classList.add("hidden");
    document.getElementById("dashboard").classList.remove("hidden");

    let percentage = Math.round((score/50)*100);
    let timeUsed = 1800 - timeRemaining;

    document.getElementById("userInfo").innerText = userName + " | " + userEmail;
    document.getElementById("finalScore").innerText = "Score: " + score + " / 50";
    document.getElementById("timeTaken").innerText = "‚è± Time Taken: " + Math.floor(timeUsed/60) + " min " + (timeUsed%60) + " sec";

    let level="Beginner";
    if(percentage>80) level="Excel Master üî•";
    else if(percentage>60) level="Advanced";
    else if(percentage>40) level="Intermediate";

    document.getElementById("performance").innerText = "Level: " + level;

    if(percentage>=60){
        document.getElementById("passFail").innerHTML="‚úÖ PASS";
        document.getElementById("passFail").style.color="green";
    }else{
        document.getElementById("passFail").innerHTML="‚ùå FAIL";
        document.getElementById("passFail").style.color="red";
    }

    // Animate Circle
    const circle = document.getElementById("progressCircle");
    const radius = 65;
    const circumference = 2 * Math.PI * radius;
    const offset = circumference - (percentage / 100) * circumference;
    circle.style.strokeDashoffset = offset;

    document.getElementById("percentageText").innerText = percentage + "%";

    await saveResult();
    loadLeaderboard();
}
</script>
</body>
</html>
